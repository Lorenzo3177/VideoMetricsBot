# Video Metrics Bot

Telegram-бот для расчёта метрик по видео на основе текстового запроса

---

## Запуск бота

### 1. Установите Docker
Установите Docker Desktop

### 2. Создайте файл `.env`

Скопируйте шаблон:

```PowerShell
Copy-Item .env.example .env
```

Заполните `.env`:

```
TELEGRAM_TOKEN=ваш_токен_бота
GIGACHAT_AUTH_KEY=ваш_auth_key_гигачата
GIGACHAT_SCOPE=GIGACHAT_API_PERS
```

---

### 3. Запуск

```bash
docker compose up --build
```

При первом запуске:

- поднимается PostgreSQL  
- автоматически создаются таблицы  
- загружаются данные  
- запускается Telegram-бот  

После этого бот готов к работе

---

### 4. Остановка

```bash
docker compose down
```

---

## Архитектура проекта

- `bot_main.py` - Telegram-бот  
- `llm_service.py` - работа с GigaChat  
- `metrics_service.py` - выполнение SQL-метрик  
- `loader.py` - загрузка данных  
- `db.py` - подключение к PostgreSQL  

---

## Принцип работы

1. Пользователь отправляет текстовый запрос  
2. Запрос передаётся в GigaChat  
3. Модель возвращает JSON-инструкцию  
4. Выполняется SQL-запрос  
5. Бот возвращает результат (только число)  

Если запрос некорректный - бот возвращает просто `0`

---

## Структура базы данных

Используются 2 таблицы:

- `videos` - информация о видео  
- `video_snapshots` - почасовые изменения метрик  

Схема создаётся автоматически при первом запуске

---
